<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Victor 的自留地</title>
  
  <subtitle>Keep Your Childlike Innocence Alive!</subtitle>
  <link href="https://victoryeah.com/atom.xml" rel="self"/>
  
  <link href="https://victoryeah.com/"/>
  <updated>2022-12-31T12:07:38.051Z</updated>
  <id>https://victoryeah.com/</id>
  
  <author>
    <name>Victor Ye</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>解决输入法尚未结束输入就触发搜索的问题丨onCompositionStart &amp; onCompositionEnd</title>
    <link href="https://victoryeah.com/post/11426bbe.html"/>
    <id>https://victoryeah.com/post/11426bbe.html</id>
    <published>2022-12-08T06:17:45.000Z</published>
    <updated>2022-12-31T12:07:38.051Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>最近开发遇到了一个很 tricky 的问题，直接上 gif，看了就明白了🤣</p></blockquote><p><img src="https://s3.bmp.ovh/imgs/2022/12/27/aefc04929a1cded1.gif" alt="bug复现"></p><p>　　可以明显看到，在搜狗拼音输入法<strong>还没有完成输入的时候</strong>就已经触发搜索了，此时根据拼音内容(一些英文)去搜索，会搜索不到任何结果，导致 Table 内显示空信息。</p><p>　　这明显不是我们想要的效果，我们所希望的应该是在输入法完成输入（按下空格或回车后）再去触发搜索框的搜索。<span id="more"></span></p><h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><blockquote><p>onCompositionStart &amp; onCompositionEnd</p></blockquote><p>　　这两个事件确实第一次接触，放上 compositionstart event 在 MDN 的截图：</p><div align=center>  <img src="https://i.niupic.com/images/2022/12/27/aejQ.jpg" /></div>&nbsp;<p>　　简单来说，搜狗拼音输入法就是图中所说的 <code>IME(Input Method Editor)</code> ，当开启一段 <code>composition session</code> 的时候就会触发这个事件，至于什么是 <code>composition session</code> 呢~</p><div align=center>  <img src="https://i.niupic.com/images/2022/12/27/aejT.jpg" /></div>  &nbsp;<p>　　知道有这个 event 之后，一切也就豁然开朗了，我们可以引入一个 <code>lock</code> 变量，通过 <code>onCompositionStart</code> &amp; <code>onCompositionEnd</code> 来维护这个 <code>lock</code> 变量，只有在 <code>lock</code> 为 <code>false</code> 的时候才触发搜索~</p><h1 id="（伪）代码"><a href="#（伪）代码" class="headerlink" title="（伪）代码"></a>（伪）代码</h1><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">Input</span></span><br><span class="line">  onChange=&#123;<span class="function"><span class="params">e</span> =&gt;</span> <span class="title function_">setInputVal</span>(e.<span class="property">target</span>.<span class="property">value</span>)&#125;</span><br><span class="line">  onCompositionStart=&#123;<span class="function">() =&gt;</span> <span class="title function_">setLock</span>(<span class="literal">true</span>)&#125;</span><br><span class="line">  onCompositionEnd=&#123;<span class="function">() =&gt;</span> <span class="title function_">setLock</span>(<span class="literal">false</span>)&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 输入拼音的情况下，选择了文字才搜索，正在输入拼音时不触发搜索</span></span><br><span class="line">  !lock &amp;&amp; <span class="title function_">triggerSearch</span>(inputVal);</span><br><span class="line">&#125;, [lock, inputVal]);</span><br></pre></td></tr></table></figure><h1 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h1><p><img src="https://s3.bmp.ovh/imgs/2022/12/27/265793f64952c3cc.gif" alt="最终效果"></p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>　　之前我一直以为这不是个前端范畴的问题，是系统层面的，事实证明还是认知局限呀🤣今后还是要多多学习，多多记录。</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;最近开发遇到了一个很 tricky 的问题，直接上 gif，看了就明白了🤣&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://s3.bmp.ovh/imgs/2022/12/27/aefc04929a1cded1.gif&quot; alt=&quot;bug复现&quot;&gt;&lt;/p&gt;
&lt;p&gt;　　可以明显看到，在搜狗拼音输入法&lt;strong&gt;还没有完成输入的时候&lt;/strong&gt;就已经触发搜索了，此时根据拼音内容(一些英文)去搜索，会搜索不到任何结果，导致 Table 内显示空信息。&lt;/p&gt;
&lt;p&gt;　　这明显不是我们想要的效果，我们所希望的应该是在输入法完成输入（按下空格或回车后）再去触发搜索框的搜索。</summary>
    
    
    
    <category term="前端开发" scheme="https://victoryeah.com/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="前端开发" scheme="https://victoryeah.com/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    <category term="JavaScript" scheme="https://victoryeah.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>提前转正啦!!!</title>
    <link href="https://victoryeah.com/post/ba9d0ab6.html"/>
    <id>https://victoryeah.com/post/ba9d0ab6.html</id>
    <published>2022-11-29T12:32:59.000Z</published>
    <updated>2022-12-31T11:43:50.349Z</updated>
    
    <content type="html"><![CDATA[<p>　　提前转正啦!!<br>　　​有太多想记录分享的，但随着相册里的照片截图越积越多却又一直没整理，原本设想的月度复盘最终演变成了微博上碎片式的文字，或许在某个时间点( maybe 年底？)会好好整理一下。</p><div align=center>  <img src="https://i.niupic.com/images/2022/12/27/aejY.jpg" /></div><span id="more"></span><p>&nbsp;<br>　　​简单 self review 了一下，相比五个月前的自己，最大的进步来自于四个方面:</p><h2 id="对-Stack-Overflow、GitHub-等社区的使用"><a href="#对-Stack-Overflow、GitHub-等社区的使用" class="headerlink" title="对 Stack Overflow、GitHub 等社区的使用"></a>对 <code>Stack Overflow</code>、<code>GitHub</code> 等社区的使用</h2><p>　　​本科期间对这些社区的使用仅限于嫖开源项目，现在逐渐能根据业务导向去探索一些解决方案了，也慢慢能够将宽泛的业务需求总结成一个个 one-sentence question 去寻找一些最佳实践。相比从前只能在 CSDN 的屎山里遨游，似乎感觉自己慢慢有 web developer 的感觉了🤣。</p><div align=center>  <img src="https://i.niupic.com/images/2022/12/28/aek3.jpg" /></div><div align=center>  <img src="https://i.niupic.com/images/2022/12/28/aek4.png" /></div><div align=center>  <img src="https://i.niupic.com/images/2022/12/28/aek5.png" /></div><center style="color:#C0C0C0;">一次完整的提 issue -> 被响应 -> 解决业务问题的经历😁</center><h2 id="面对业务难题的心态"><a href="#面对业务难题的心态" class="headerlink" title="面对业务难题的心态"></a>面对业务难题的心态</h2><p>　　如果要选这五个月来最难的一个需求，我觉得是贡献度页面的 PDF 下载——用从未使用过的库(html2canvas &amp; jspdf)去完成一个定制化很高的需求。<br>　　拆开看其实就是两个大难点——<code>从未使用过</code> &amp; <code>定制化很高</code>。<br>　　前者还好，只需要花时间去读文档试 API；但对于后者，则意味着网上不会有完全可以参照的解决方案。</p><div align=center>  <img src="https://i.niupic.com/images/2022/12/31/aetx.png" /></div><center style="color:#C0C0C0;">需要实现的 PDF 下载逻辑</center><p>　　官方文档的目的是用最简示例让你明白核心 API 的用法，但如何去组合可用的几十上百个 API 来完成业务需求，这个是官方文档没法 cover 到的。记得刚开始做的时候确实毫无头绪，后来真的是某个瞬间突然有了想法：html2canvas 是基于 DOM node 的，那我结合业务需求去手动控制 DOM node 是不是就可以了呢？后来尝试了一个简单的 case 发现确实可以！<br>　　有了大方向，后面去磨逻辑就可以了，细节会非常多，但到了这个阶段，其实已经演变成了和第一个难点同一级别的问题了——花时间就可以解决的问题，俗称体力活🤣。<br>　　这个需求完成之后，有种完成进化的感觉。</p><div align=center>  <img src="https://i.niupic.com/images/2022/12/31/aerR.png" /></div><center style="color:#C0C0C0;">完成后提的 PR </center><p>　　quote 一下关于这件事的微博，记录了我的思考： </p><blockquote><p>　　最近刚做完一个比较特殊的导出 PDF 需求，用的两个库都是第一次接触( <code>html2canvas</code> &amp; <code>jspdf</code> )，一路上遇到了不少坑，最后都摸索着解决了。作为一个喜欢复盘的人，本来想着好好复盘一下这两个库的使用流程，但是后来好像就突然醒悟了：为什么要去细抠这两个库呢，在未来十几年开发生涯里用到这两个库的次数大概率屈指可数，真正有价值的其实是那些坑，是那些开发过程中的瓶颈，或者说，是跨过坑和迈过瓶颈的思考过程和处理方法。<br>　　其实是一个很简单的道理，相比聚焦于某个具体问题。作为一名工程师，需要培养的其实是解决问题的能力。从而达到一种 mentality:</p><ul><li>任何问题都有解决的方法</li><li>我遇到的问题也是</li><li>我一定可以解决它</li></ul></blockquote><h2 id="​bug-的分析-amp-调试"><a href="#​bug-的分析-amp-调试" class="headerlink" title="​bug 的分析 &amp; 调试"></a>​bug 的分析 &amp; 调试</h2><p>　　这点或许就是所谓的<code>经验</code>，开发年限久了，见识的场景多了，改 bug 的能力就自然而然提升了。<br>　　就我的例子而言，反映在​对组件渲染、状态流动、异步有了更深的认识，所以打断点越来越准确，定位问题越来越快了。<br>　　此外，也离不开其他前端家人们的 code review 与 comments，我在解决完一些比较 tricky 的 bug 的时候都会尽可能把心路历程和来龙去脉写在 commit message 里，我觉得能把原因-分析-解决的链路描述清楚，才算真正地吃透了这个 bug；此外，一般的 code review 大家只会看代码的风格是否可以优化，没太多时间去细究内部的业务逻辑(大家手头都有活)，但有了比较详尽的 description 之后能让 reviewer 更好地理解场景，有时他们会提供一些更好的思路，让我发现其实是我搞复杂了。</p><div align=center>  <img src="https://i.niupic.com/images/2022/12/31/aetH.jpg" /></div><div align=center>  <img src="https://i.niupic.com/images/2022/12/31/aetI.jpg" /></div><center style="color:#C0C0C0;">解决一些 tricky bug 的 PR </center><h2 id="技术文档的书写"><a href="#技术文档的书写" class="headerlink" title="技术文档的书写"></a>技术文档的书写</h2><p>　　像<code>大字版</code>和<code>埋点</code>这两个需求，我算是前端的 owner，从调研技术实现，到这两个模块的基建，再到书写文档和各位前端家人一起维护，有体验到一种 leadership 的感觉，是一种从未有过的体验😁。</p><div align=center>  <img src="https://i.niupic.com/images/2022/12/31/aetL.jpg" /></div><div align=center>  <img src="https://i.niupic.com/images/2022/12/31/aetT.png" /></div><center style="color:#C0C0C0;">埋点的基建 & 文档</center>&nbsp;<div align=center>  <img src="https://i.niupic.com/images/2022/12/31/aetU.png" /></div><center style="color:#C0C0C0;">大字版文档</center><p>　　包括在做某个功能的时候需要复用一个很复杂的组件，在确定复用方案上我也接受了紫月老师的建议，写了篇文档把两种方式做了对比，最终和大家讨论选取了一个更适合的方案。</p><div align=center>  <img src="https://i.niupic.com/images/2022/12/31/aetX.jpg" /></div><center style="color:#C0C0C0;">关于复用方案的评估文档</center><p>　　​这个习惯深受<a href="https://liriansu.com/">紫月老师</a>的影响。把零碎的思路形成易于接受的、有条理的文字是一件很浪漫的事情。(顺便感叹一句飞书文档真的好用，国庆去敦煌做了份<a href="https://hzt1zdrg2z.feishu.cn/docx/Kz4rd8NBQopGH4xggircbhuhnqc?from=from_copylink">攻略</a>，一开始用的是 Google Docs，不是很顺手，换飞书文档之后体验大大提升，强烈安利😋)</p><h2 id="End"><a href="#End" class="headerlink" title="End"></a>End</h2><p>　　下班之后​随手写了点，anyway，保持热爱，继续前进!</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;　　提前转正啦!!&lt;br&gt;　　​有太多想记录分享的，但随着相册里的照片截图越积越多却又一直没整理，原本设想的月度复盘最终演变成了微博上碎片式的文字，或许在某个时间点( maybe 年底？)会好好整理一下。&lt;/p&gt;
&lt;div align=center&gt;
  &lt;img src=&quot;https://i.niupic.com/images/2022/12/27/aejY.jpg&quot; /&gt;
&lt;/div&gt;</summary>
    
    
    
    <category term="随笔" scheme="https://victoryeah.com/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
    <category term="随笔" scheme="https://victoryeah.com/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>或许遭遇了人生最大的 setback ?</title>
    <link href="https://victoryeah.com/post/7709adb1.html"/>
    <id>https://victoryeah.com/post/7709adb1.html</id>
    <published>2022-06-13T15:11:01.000Z</published>
    <updated>2022-12-31T07:00:34.860Z</updated>
    
    <content type="html"><![CDATA[<p>　　6.7，毕设答辩结束后两个小时，明略告知我要毁约，仿佛当头一棒。<span id="more"></span><br>　　其实前两周在脉脉已经听到了些风声，大致是说公司动用 1500 人做了一年半的产品 (EIP) 失败了，疫情和外部环境雪上加霜，公司现金流已极度不健康，要裁员 70%，3500 人的公司只留 800 人。</p><div align=center>  <img src="https://i.niupic.com/images/2022/12/26/aehl.jpg" width=256 /></div><center style="color:#C0C0C0;">CEO 发的全体邮件</center><p>　　即使消息一直在发酵，我还是相对乐观，因为那些爆料人也说了，秒针(我们部门)作为独立的核心部门，是不会有大动作的。</p><div align=center>  <img src="https://i.niupic.com/images/2022/12/25/aehj.jpg" width=256 /></div><center style="color:#C0C0C0;">看着明略的同事圈热度一路飙升</center><p>　　而且，我去提前实习了近四个月，如期完成了布置给我的所有开发任务，出色地融入了团队，就算真的要毁约一批校招生，相比那些没去提前实习的同学，我也有绝对的优势能够留下。<br>　　最后，也是一丝侥幸心理，6 月份了，即使公司再没有人性，也做不出在毕业前两个礼拜毁约的举动吧，这不仅是毁人前途，也是断人后路。<br>　　但还是发生了，击碎了我最后的幻想。</p><div align=center>  <img src="https://i.niupic.com/images/2022/12/25/aehf.jpg" /></div><center  style="color:#C0C0C0;">甚至在 5.23 还发了入职提示邮件</center><p>　　好笑的是，在被毁约的前一天，我都还在为相同遭遇的应届生们抱不平。</p><div align=center>  <img src="https://i.niupic.com/images/2022/12/25/aehk.jpg" width=300 /></div><center  style="color:#C0C0C0;">一语成谶</center><p>　　7 号下午我处在崩溃的边缘，我的理性压制着杂乱稀碎的情绪，我努力告诉自己，去消化这个消息，去做对当下最好的决定。<br>　　我在找一个可以发泄的点，尝试将这个结果归咎于我的某一个错误决定或举动，但我找不到。<br>　　从去年 3 月份开始，我刷了五十多套视频，背了无数的面经八股，从 9.7 第一场面试开始，20 天拿到了 3 份 offer，10.9 明略正式给我开了 30k 的意向书，我觉得秋招圆满收官了，也拒绝了此后的所有笔面试流程。</p><div align=center>  <img src="https://i.niupic.com/images/2022/12/25/aehi.jpg" /></div><center  style="color:#C0C0C0;">结束我秋招的 offer</center><p>　　我开始帮朋友们辅导面试、和他们分享学习路线、解决群友们的开发问题。这份 offer 让我保持着学习的热情，让我愿意放弃最后的校园生活去公司提前适应。公司的一切也让我无比满意，顶级的办公环境、前沿的技术栈、扁平的团队氛围、还有知无不言、贴心带着我成长的 mentor。</p><div align=center>    <img src="https://i.niupic.com/images/2022/12/26/aehm.jpg" width=500 /></div><div align=center>    <img src="https://i.niupic.com/images/2022/12/26/aehn.jpg" width=500 /></div><center  style="color:#C0C0C0;">那时候确实很热爱这里</center><br/><div align=center>    <img src="https://i.niupic.com/images/2022/12/25/aehg.jpg" width=500 /></div><div align=center>    <img src="https://i.niupic.com/images/2022/12/25/aehh.jpg" width=500 /></div><center  style="color:#C0C0C0;">津铭哥对我真的很好</center> <p>　　我曾经跑在前面，但一个解约电话和一份违约金让我回到了起点。<br>　　这就是绝境了吧？秋招的另外两份 offer 询问后被告知已经没有 hc 了，形势本就惨淡的春招完全结束，补录也所剩无几，即使还有面试机会，实习之后的我专注于业务，用来应付笔面试的八股文和算法也已淡忘生疏。<br>　　更何况，离毕业只有 20 天了，要去公司办离职手续，走毁约流程，要去了解封校期间的就业办政策，处理毕业事宜，要投简历，要去捡起淡忘的八股文和算法，我问自己，这怎么可能办得到呢。<br>　　曾经的野心和理想开始反噬我，我从未陷入过这个程度的自我怀疑。<br>　　晚上，我收拾了一下情绪，开始检索各个招聘平台，牛客、毕业申、智联、boss，我投递了所有还能投递的公司。<br>　　8 号醒的时候天还黑着，看了眼手机 4 点多，但没有了睡意，起床开始看秋招时的面经和笔记。上午开始陆续有 hr 联系我。第一个面试在下午两点半，五位面试官，持续一个多小时，一面过。晚上七点，另一家公司，将近一个小时，一面过。我屏蔽了所有的社交媒体，不让自己的思绪有一丝空闲，我怕那种随之而来的窒息感。<br>　　随着 9 号两场面试的通过，我的状态好些了，但更开心的是遇到了心仪的公司：在淮海中路，位置热闹、技术栈前沿，leader 是保送交大的竞赛生，hr 给我分享了他的博客，映入眼帘的第一篇：《那个喊了十三声发物资的邻居》，翻到最下面，看到一篇 2013 年的文章：《妈的，交大》，我的第一感觉：他是个有趣的人。面试的时候他也让我感受到了一种和那些生硬地问一个个技术问题的面试官不同的感觉。腾讯会议里还有另一位女生，他告诉我，这位女生本科也是交大，硕士在密歇根大学，同样是今年的校招生，如果我加入，以后大家就是同一个 team 了，我说，我喜欢和优秀的人在一起。在我一面通过并表达强烈的加入愿景之后，他也承诺会为我加快推进流程。<br>　　9 号晚上做完了笔试，10号下午 cto 面 + hr 面，晚上 6 点半等来了 offer call。<br>　　放下手机，也许是这几天没怎么休息，有些恍惚。两天前我以为最终的结局或许就是要去国企或者某个小厂冒着野心和技术慢慢被消磨的风险去沉淀（如果消磨太多的话或许是沉沦？）两三年，幸好，现在又有了在互联网泥沼里摸爬滚打的机会。我联系了其他几家的 hr，表示已经接到了合适的 offer，也对他们表达了最诚挚的感谢，在这个时间点给了我面试的机会，让我不至于沉浸在惶恐却什么都做不了的绝望情绪里。<br>　　这几天也让我明确了一些事，好像也就两件，第一件就是去搭一个博客，我会把这篇放上去，作为第一篇文章。我突然联想到高中，当时想着要写写日记，但一直没开始，后来第一次下笔是在 2015.11.11，因为那天月考还是期中考成绩出来了，我数学没及格，很伤心，突然就有了下笔的冲动，没想到就坚持了下来，每天晚自修的最后十分钟写个几行，坚持了三年。或许这次也是个开始的契机吧。说到这个就想起来日记本还在上大寝室的架子上，不知道啥时候才能回去搬寝室。<br>　　第二件事情就是，应该再也没有过不去的坎了，至少我现在是这样觉得的。<br>　　还有很多事情要处理，先写到这吧。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;　　6.7，毕设答辩结束后两个小时，明略告知我要毁约，仿佛当头一棒。</summary>
    
    
    
    <category term="随笔" scheme="https://victoryeah.com/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
    <category term="随笔" scheme="https://victoryeah.com/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>回调函数也能主动调用丨antd Table 组件外实现全选 &amp; 取消全选</title>
    <link href="https://victoryeah.com/post/d87f7e0c.html"/>
    <id>https://victoryeah.com/post/d87f7e0c.html</id>
    <published>2022-04-23T10:54:37.000Z</published>
    <updated>2022-12-31T12:08:05.652Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>　　最近在做宝马的一个项目，遇到一个很常见的需求，上个图大家就懂了:</p><div align=center>  <img src="https://i.niupic.com/images/2022/12/26/aeiB.jpg" /></div><center style="color:#C0C0C0;">原型图</center><span id="more"></span><p>　　然而，antd 官网给的例子里只有在组件中的实现方法（通过 <code>rowSelection</code> 配置），如下图:</p><div align=center>  <img src="https://i.niupic.com/images/2022/12/27/aeiG.jpg" /></div><center style="color:#C0C0C0;">antd 提供的功能</center><p>　　如果想要做到原型图这样在组件外实现全选 &amp; 取消全选，则需要更灵活地运用 <code>rowSelection</code> 这个配置项。</p><h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [selectedRowKeys, setSelectedRowKeys] = <span class="title function_">useState</span>([]);</span><br><span class="line"><span class="keyword">const</span> [selectedRows, setSelectedRows] = <span class="title function_">useState</span>([]);</span><br><span class="line"><span class="keyword">const</span> [tableData, setTableData] = <span class="title function_">useState</span>([]);</span><br><span class="line"></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">setTableData</span>(mock); <span class="comment">// 将 tableData 先设为表格内的全部数据</span></span><br><span class="line">&#125;, []); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 关键点：这个函数既作为回调函数，也能手动调用～</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleChange</span> = (<span class="params">selectedRowKeys, selectedRows</span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">setSelectedRowKeys</span>([...selectedRowKeys]);</span><br><span class="line">  <span class="title function_">setSelectedRows</span>([...selectedRows]);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 点击 选择全部 的回调函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">selectAll</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  tableData.<span class="title function_">forEach</span>(<span class="function">(<span class="params">o, i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 遍历，和全部的 tableData 作对比，找到没有勾选的 row, 将它的 key 值保存到 selectedRowKeys 数组</span></span><br><span class="line">    <span class="keyword">if</span> (!selectedRows.<span class="title function_">includes</span>(o)) selectedRowKeys.<span class="title function_">push</span>(tableData[i].<span class="property">account</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// 手动修改 selectedRowKeys，和 Table 组件内的 selectedRowKeys 联动</span></span><br><span class="line">  <span class="title function_">handleChange</span>(selectedRowKeys, [...tableData]); </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 点击 取消全部 的回调函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">selectNone</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 手动修改 selectedRowKeys 和 selectedRows，全部置为空</span></span><br><span class="line">  <span class="title function_">handleChange</span>([], []);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rowSelection = &#123;</span><br><span class="line">  selectedRowKeys, <span class="comment">// 受控</span></span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;checkbox&quot;</span>,</span><br><span class="line">  <span class="attr">onChange</span>: handleChange <span class="comment">// 将 handleChange 定义在外面，从而可以手动调用</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Table 组件，略去了无关配置</span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Table</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">rowKey</span>=<span class="string">&quot;account&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">columns</span>=<span class="string">&#123;columns&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">dataSource</span>=<span class="string">&#123;mock&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">rowSelection</span>=<span class="string">&#123;rowSelection&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">/&gt;</span></span></span><br></pre></td></tr></table></figure><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>　　其实最关键的地方就是 <code>rowSelection</code> 里的 <code>onChange</code> ，通常的回调函数我们不会直接调用，而在这里，如果要实现在表格外全选，则需要手动调用这个 <code>onchange</code> 。</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;　　最近在做宝马的一个项目，遇到一个很常见的需求，上个图大家就懂了:&lt;/p&gt;
&lt;div align=center&gt;
  &lt;img src=&quot;https://i.niupic.com/images/2022/12/26/aeiB.jpg&quot; /&gt;
&lt;/div&gt;
&lt;center style=&quot;color:#C0C0C0;&quot;&gt;原型图&lt;/center&gt;</summary>
    
    
    
    <category term="前端开发" scheme="https://victoryeah.com/categories/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="antd" scheme="https://victoryeah.com/tags/antd/"/>
    
    <category term="前端开发" scheme="https://victoryeah.com/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/"/>
    
    <category term="JavaScript" scheme="https://victoryeah.com/tags/JavaScript/"/>
    
  </entry>
  
</feed>
